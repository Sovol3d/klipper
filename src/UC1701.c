   
//**************************************UC1701 96*49 DOTS *************************
#include "UC1701.h"
#include "stm32/internal.h"
#include "stm32/gpio.h"
#include "generic/armcm_timer.h" 
#include "sched.h"
#include "command.h"
#include <string.h>
#include <stdlib.h>

#define unchar  unsigned char
#define unint   unsigned int 

extern unsigned char ucSmallFont[];
static int iScreenOffset; // current write offset of screen data
extern char end;

typedef enum
{
	FONT_NORMAL=0,
	FONT_BIG,
	FONT_SMALL
} FONTSIZE;
//--------------------------------------------------------- 4��SPI�ӿ� ����
									  
/*#define  RSTB	PDout(15)   //PD15  reset
#define	 SCL	PDout(13)	 //PD13
#define  SDI  PDout(11)  //PD11
#define  RS   PDout(9)   //PD9    D/C
#define  CS0  PBout(15)    //PB15   
	gpio_peripheral(GPIO('A', 10), GPIO_OUTPUT, 0);  //CS PA10
	gpio_peripheral(GPIO('A', 9), GPIO_OUTPUT, 0);	 //A0 PA9
	gpio_peripheral(GPIO('C', 11), GPIO_OUTPUT, 0);  //RST PC11
	gpio_peripheral(GPIO('B', 15), GPIO_OUTPUT, 0);  //MOSI PB15
	gpio_peripheral(GPIO('B', 13), GPIO_OUTPUT, 0);  //SCLK  PB13
*/

#define RSTB_H gpio_out_setup(GPIO('C', 11), 1);
#define RSTB_L gpio_out_setup(GPIO('C', 11), 0);
#define CS0_H  gpio_out_setup(GPIO('A', 10), 1);
#define CS0_L  gpio_out_setup(GPIO('A', 10), 0);
#define RS_H   gpio_out_setup(GPIO('A', 9), 1);
#define RS_L   gpio_out_setup(GPIO('A', 9), 0);
#define SDI_H  gpio_out_setup(GPIO('B', 15), 1);
#define SDI_L  gpio_out_setup(GPIO('B', 15), 0);
#define SCL_H  gpio_out_setup(GPIO('B', 13), 1);
#define SCL_L  gpio_out_setup(GPIO('B', 13), 0);

unchar graphic1[]=
{
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xE0,0xF0,0xF8,0xF8,0x78,0x78,0x78,0x78,0x78,0x78,0x78,0x78,0x78,0x78,0x78,0x78,0x00,0x80,0xC0,0xE0,0xF0,0xF8,0xF8,0x78,0x78,0x00,0x00,0x78,0x78,0xF8,
0xF8,0xF0,0xE0,0xC0,0x80,0x18,0x78,0xF8,0xF8,0xF8,0xE0,0x80,0x00,0x00,0x00,0x00,0x00,0x80,0xE0,0xF8,0xF8,0xF8,0x78,0x18,0x80,0xC0,0xE0,0xF0,0xF8,0xF8,0x78,0x78,0x00,0x00,0x78,0x78,0xF8,0xF8,0xF0,0xE0,0xC0,0x80,0x00,0xF8,0xF8,0xF8,0xF8,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x07,0x0F,0x1F,0x1F,0x1E,0x1E,0x1E,0x1E,0x1E,0x1E,0x1E,0x1E,0xFE,0xFE,0xFC,0xF8,0x00,0xFF,0xFF,0xFF,0xFF,0xC1,
0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x80,0xC1,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x01,0x07,0x1F,0x7F,0xFF,0xFE,0xF8,0xE0,0xF8,0xFE,0xFF,0x7F,0x1F,0x07,0x01,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xC1,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x80,0xC1,0xFF,0xFF,0xFF,0xFF,0x00,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0F,0x0F,0x0F,0x0F,0x0F,0x0F,0x0F,0x0F,0x0F,0x0F,0x0F,0x0F,0x0F,0x0F,
0x07,0x03,0x00,0x00,0x01,0x03,0x07,0x0F,0x0F,0x0F,0x0F,0x00,0x00,0x0F,0x0F,0x0F,0x0F,0x07,0x03,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x07,0x0F,0x0F,0x0F,0x07,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x03,0x07,0x0F,0x0F,0x0F,0x0F,0x00,0x00,0x0F,0x0F,0x0F,0x0F,0x07,0x03,0x01,0x00,0x00,0x03,
0x07,0x0F,0x0F,0x0F,0x0F,0x0F,0x0F,0x0F,0x0F,0x0F,0x0F,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xE0,0xF0,0xB0,0xB0,0xB0,0x30,0x00,0xF0,0xF0,0x00,0x00,0xF0,
0xF0,0x00,0xE0,0xF0,0xB0,0xB0,0xB0,0x30,0x00,0x60,0xFC,0xFC,0x60,0x60,0x00,0xE0,0xF0,0xB0,0xB0,0xF0,0xE0,0x00,0xE0,0xF0,0x30,0x70,0xE0,0xE0,0x70,0x30,0xF0,0xE0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFE,0xFE,0x30,0x30,0x30,0xF0,0xE0,0x00,0xE0,0xF0,0x30,0x30,0x30,0xF0,0xE0,0x00,0xE0,0xF0,0x30,0x30,
0x30,0xF0,0xE0,0x00,0x60,0xFC,0xFC,0x60,0x60,0x00,0xEC,0xEC,0x00,0xE0,0xF0,0x30,0x30,0xF0,0xE0,0x00,0xE0,0xF0,0x30,0x30,0x30,0xF0,0xE0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0C,0x0D,0x0D,0x0D,
0x0F,0x07,0x00,0x03,0x47,0x66,0x36,0x1F,0x0F,0x00,0x0C,0x0D,0x0D,0x0D,0x0F,0x07,0x00,0x00,0x07,0x0F,0x0C,0x0C,0x00,0x07,0x0F,0x0D,0x0D,0x0D,0x0D,0x00,0x0F,0x0F,0x00,0x00,0x0F,0x0F,0x00,0x00,0x0F,0x0F,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0F,0x0F,0x0C,0x0C,0x0C,0x0F,0x07,0x00,0x07,0x0F,0x0C,0x0C,
0x0C,0x0F,0x07,0x00,0x07,0x0F,0x0C,0x0C,0x0C,0x0F,0x07,0x00,0x00,0x07,0x0F,0x0C,0x0C,0x00,0x0F,0x0F,0x00,0x0F,0x0F,0x00,0x00,0x0F,0x0F,0x00,0x33,0x77,0x66,0x66,0x66,0x7F,0x3F,0x00,0x00,0x0C,0x0C,0x00,0x00,0x0C,0x0C,0x00,0x00,0x0C,0x0C,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00
};

unchar erroMessage[]=
{
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x80,0x80,0x80,0x80,0x80,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x80,0x80,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x80,0x80,0x80,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xC0,0xC0,0xC0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xC0,0xC0,0xC0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x10,0x10,0x1F,0x1F,0x00,0xFC,0xFC,0xFC,0x0C,0x04,0x04,0xFD,0xFD,0xFD,0x00,0xFC,0xFC,0xFC,0x0C,0x04,0xFC,0xFC,0xFC,0x04,0xFF,0xFF,0xFF,0x04,0xFC,0xFC,0xFC,0x24,0x24,0x3C,0x3C,0x38,0xFC,0xFC,0xFC,0x0C,0x04,0x04,
0x00,0x00,0xFD,0xFD,0xFD,0x00,0x18,0x3C,0x3C,0xE4,0xE4,0xC4,0x00,0x00,0x00,0x00,0x18,0x3C,0x3C,0xE4,0xE4,0xC4,0xFF,0xFF,0xFF,0x0C,0x04,0xFC,0xFC,0xF8,0x7C,0xFC,0xFC,0x80,0x80,0xFC,0xFC,0xFC,0x04,0xFF,0xFF,0xFF,0x04,0xFC,0xFC,0xFC,0x04,0x8C,0xFF,0xFF,0xFF,0xF8,0xFC,0xFC,0x04,0x04,0x8C,0xFC,0xF8,0x00,
0x1C,0xFC,0xFC,0xE0,0xFC,0x7C,0xFC,0xF0,0xF0,0xFC,0x3C,0xFC,0xFC,0xFC,0x0C,0x04,0xFC,0xFC,0xF8,0x00,0x00,0x00,0x00,0x01,0x01,0x00,0x00,0x00,0x00,0x00,0x01,0x01,0x01,0x00,0x00,0x00,0x01,0x01,0x01,0x00,0x01,0x01,0x01,0x00,0x00,0x01,0x01,0x01,0x00,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,
0x01,0x01,0x01,0x01,0x00,0x00,0x00,0x00,0x00,0x01,0x01,0x01,0x00,0x01,0x01,0x01,0x01,0x01,0x01,0x00,0x00,0x00,0x00,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x00,0x00,0x01,0x01,0x01,0x00,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x00,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x00,0x01,
0x01,0x01,0x01,0x01,0x01,0x00,0x00,0x00,0x00,0x01,0x01,0x01,0x00,0x01,0x01,0x01,0x01,0x00,0x01,0x01,0x01,0x00,0x00,0x01,0x01,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x80,0x80,0x80,0x80,0x80,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xC0,0xC0,0xC0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x80,0x80,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x10,0x30,0xFF,0xFF,0xCF,0x00,0xF8,0xFC,0xFC,0x24,0x24,0x3C,0x3C,0x38,0x18,0x3C,0x3C,0xE4,
0xE4,0xC4,0x04,0xFF,0xFF,0xFF,0x04,0xCC,0xEC,0xEC,0x24,0xAC,0xFC,0xFC,0xFC,0xFC,0xFC,0x0C,0x04,0x04,0x04,0xFF,0xFF,0xFF,0x04,0x04,0x00,0x04,0x04,0xFF,0xFF,0xFF,0x04,0xFF,0xFF,0xFF,0x0C,0x04,0xFC,0xFC,0xF8,0xF8,0xFC,0xFC,0x24,0x24,0x3C,0x3C,0x38,0x00,0x00,0x00,0x00,0xFC,0xFC,0xFC,0x8C,0x04,0xCC,0xFC,
0xF8,0xFC,0xFC,0xFC,0x0C,0x04,0x04,0xFD,0xFD,0xFD,0x00,0xFC,0xFC,0xFC,0x0C,0x04,0xFC,0xFC,0xFC,0x04,0xFF,0xFF,0xFF,0x04,0xFC,0xFC,0xFC,0x24,0x24,0x3C,0x3C,0x38,0xFC,0xFC,0xFC,0x0C,0x04,0x04,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x01,0x00,0x00,0x00,0x01,0x01,0x01,0x00,0x01,0x01,0x01,0x01,
0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x00,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x00,0x00,0x00,0x00,0x01,0x01,0x01,0x01,0x01,0x00,0x00,0x00,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x00,0x00,0x01,0x01,0x01,0x00,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x00,0x00,0x00,0x00,
0x0F,0x0F,0x0F,0x01,0x01,0x01,0x01,0x00,0x01,0x01,0x01,0x00,0x00,0x00,0x01,0x01,0x01,0x00,0x01,0x01,0x01,0x00,0x00,0x01,0x01,0x01,0x00,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00
};


void Init_S6B33B(void);
void Write_S6B33B_COM(unchar COMDADA_4SPI);
void Write_S6B33B_DISPLAY_DATA_serial_4SPI(unchar DADA_4SPI);
void delay_ms(uint32_t value);
void HDReset(void);
//void Keypress(void);
void clear_screen(unchar xx);
void Display_pic1(unchar graphic[]);
void Display_fangkuang(void);

void delay_ms(uint32_t value)
{
	udelay(1000 * value);
}

void io_Init(void)
{
	gpio_peripheral(GPIO('A', 10), GPIO_OUTPUT, 0);  //CS PA10
	gpio_peripheral(GPIO('A', 9), GPIO_OUTPUT, 0);	 //A0 PA9
	gpio_peripheral(GPIO('C', 11), GPIO_OUTPUT, 0);  //RST PC11
	gpio_peripheral(GPIO('B', 15), GPIO_OUTPUT, 0);  //MOSI PB15
	gpio_peripheral(GPIO('B', 13), GPIO_OUTPUT, 0);  //SCLK  PB13
}

void start_lcd(void)
{	
	io_Init();
	Init_S6B33B();
	delay_ms(100);
	clear_screen(0x00);
	Display_pic1(graphic1);
}

//--------------------------------------------------------------------------

void Init_S6B33B(void)
{
	HDReset();
	delay_ms(100);

	Write_S6B33B_COM(0xe2);
	Write_S6B33B_COM(0x40);
	Write_S6B33B_COM(0xa0);
	Write_S6B33B_COM(0xc8);
	Write_S6B33B_COM(0xa2);
	Write_S6B33B_COM(0x2c);
	Write_S6B33B_COM(0x2e);
	Write_S6B33B_COM(0x2f);
	
	Write_S6B33B_COM(0xf8);
	Write_S6B33B_COM(0x00);
	
	Write_S6B33B_COM(0x23);
	Write_S6B33B_COM(0x81);
	Write_S6B33B_COM(0x36);
	Write_S6B33B_COM(0xac);
	Write_S6B33B_COM(0x00);
	Write_S6B33B_COM(0xa6);
	Write_S6B33B_COM(0xaf);
	Write_S6B33B_COM(0xa5);
	Write_S6B33B_COM(0xa4);
}


void clear_screen(unchar xx)
{
unchar i,j;
for(i=0;i<9;i++)
	{
		CS0_L;
		Write_S6B33B_COM(0xb0+i);
	    Write_S6B33B_COM(0x10);
		Write_S6B33B_COM(0x00);
		for(j=0;j<132;j++)
		{
			Write_S6B33B_DISPLAY_DATA_serial_4SPI(xx);
		}
	 }
}

void Display_pic1(unchar graphic[])
{
	unint i,j,adressd=0;

	for(i=0;i<8;i++)
	{
		CS0_L;
		Write_S6B33B_COM(0xb0+i);
	    Write_S6B33B_COM(0x10);
		Write_S6B33B_COM(0x00);
		for(j=0;j<128;j++)
		{
			Write_S6B33B_DISPLAY_DATA_serial_4SPI(graphic[adressd]);
			adressd++;
		}
	}
} 
void Display_fangkuang(void)
{
	unint i,j;
	for(i=0;i<5;i++)
	{
		CS0_L;
		Write_S6B33B_COM(0xb0+i);
	    Write_S6B33B_COM(0x10);
		Write_S6B33B_COM(0x00);
		Write_S6B33B_DISPLAY_DATA_serial_4SPI(0xff);
		for(j=0;j<94;j++)
		{
			Write_S6B33B_DISPLAY_DATA_serial_4SPI(0x00);
		}
		Write_S6B33B_DISPLAY_DATA_serial_4SPI(0xff);
	 }

		CS0_L;
		Write_S6B33B_COM(0xb5);
	    Write_S6B33B_COM(0x10);
		Write_S6B33B_COM(0x00);
		Write_S6B33B_DISPLAY_DATA_serial_4SPI(0xff);
		for(j=0;j<94;j++)
		{
			Write_S6B33B_DISPLAY_DATA_serial_4SPI(0x80);
		}
		Write_S6B33B_DISPLAY_DATA_serial_4SPI(0xff);

		CS0_L;
		Write_S6B33B_COM(0xb8);	//set page
	    Write_S6B33B_COM(0x10);	//set address LSB
		Write_S6B33B_COM(0x00);	//set address HSB

		for(j=0;j<96;j++)
		{
			Write_S6B33B_DISPLAY_DATA_serial_4SPI(0x01);
		}
	
}
//***************************************************************************SPI4
void Write_S6B33B_COM(unchar COMDADA_4SPI)
{
	unchar bit8;
	RS_L;
	CS0_L;
	for(bit8=0;bit8<8;bit8++)
	{
		SCL_L;
		if((COMDADA_4SPI&0x80)==0x80) {
			SDI_H;
		} else {
			SDI_L;
		}
//		SCL=0;
		SCL_H;
		COMDADA_4SPI=(COMDADA_4SPI<<1);

	}
  //  CS1=1;
			
}

void Write_S6B33B_DISPLAY_DATA_serial_4SPI(unchar DADA_4SPI)
{   
	unchar bit8;
	RS_H;
	CS0_L;				

	for(bit8=0;bit8<8;bit8++)
	{
		SCL_L;
		if((DADA_4SPI&0x80)==0x80) {
			SDI_H;
		} else {
			SDI_L;
		}
		SCL_H;
		DADA_4SPI=(DADA_4SPI<<1);

	}
//	CS1=1;
}

/* -------------------------------------------  */
// Send commands to position the "cursor" to the given
// row and column
void uc1701WriteCommand(unchar c)
{
	Write_S6B33B_COM(c);
}

static void uc1701SetPosition(int x, int y)
{
	uc1701WriteCommand(0xb0 | y); // set Y
	uc1701WriteCommand(0x10 | (x >> 4)); // set X (high MSB)
	uc1701WriteCommand(0x00 | (x & 0xf)); // set X (low MSB)
	iScreenOffset = (y*128)+x;
}

// Write a block of pixel data to the LCD
// Length can be anything from 1 to 504 (whole display)
static void uc1701WriteDataBlock(unsigned char *ucBuf, int iLen)
{

	RS_H;
	// AIOWriteSPI(file_spi, ucBuf, iLen);
	for(int j=0;j<iLen;j++)
	{
		Write_S6B33B_DISPLAY_DATA_serial_4SPI(ucBuf[j]);
	}
	// Keep a copy in local buffer
	// memcpy(&ucScreen[iScreenOffset], ucBuf, iLen);
	iScreenOffset += iLen;
}

// Draw a string of small (8x8) or large (16x24) characters
// At the given col+row
int uc1701WriteString(int x, int y, char *szMsg, int iSize)
{
int i, iLen;
unsigned char *s;

	iLen = strlen(szMsg);
	if (iSize == FONT_BIG) // draw 16x32 font
	{
		if ((iLen*16)+x > 128) iLen = (128-x)/16;
		if (iLen < 0) return -1;
		for (i=0; i<iLen; i++)
		{
			// s = &ucFont[9728 + (unsigned char)szMsg[i]*64];
			// uc1701SetPosition(x+(i*16), y);
			// uc1701WriteDataBlock(s, 16);
			// uc1701SetPosition(x+(i*16), y+1);
			// uc1701WriteDataBlock(s+16, 16);	
			// uc1701SetPosition(x+(i*16), y+2);
			// uc1701WriteDataBlock(s+32, 16);	
			// uc1701SetPosition(x+(i*16), y+3);
			// uc1701WriteDataBlock(s+48, 16);
		}
	}
	else if (iSize == FONT_NORMAL) // draw 8x8 font
	{
		uc1701SetPosition(x, y);
		if ((8*iLen) + x > 128) iLen = (128 - x)/8; // can't display it all
		if (iLen < 0)return -1;

		for (i=0; i<iLen; i++)
		{
			// s = &ucFont[(unsigned char)szMsg[i] * 8];
			// uc1701WriteDataBlock(s, 8); // write character pattern
		}	
	}
	else // small
	{
		uc1701SetPosition(x, y);
		if ((6*iLen) + x > 128) iLen = (128 - x)/6;
		if (iLen < 0) return -1;
		for (i=0; i<iLen; i++)
		{
			s = &ucSmallFont[(unsigned char)szMsg[i]*6];
			uc1701WriteDataBlock(s, 6);
		}
	}
	return 0;
} /* uc1701WriteString() */

void HDReset(void)
{
	RSTB_L;
	delay_ms(2);
	RSTB_H;
	delay_ms(4);
}   	

void uc1701_shutdown(int reason)
{
	char buf[20] = "error code: ";
	char code[10] = {0};
	io_Init();
	Init_S6B33B();
	delay_ms(10);
	clear_screen(0x00);
	itoa(reason, code, 10);
	strcat(buf, code);
	uc1701WriteString(2, 1, "Printer is shutdown", FONT_SMALL);
	uc1701WriteString(2, 3, "Restart the printer", FONT_SMALL);
	uc1701WriteString(2, 5, buf, FONT_SMALL);
}

//DECL_SHUTDOWN(uc1701_shutdown);